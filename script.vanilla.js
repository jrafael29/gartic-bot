(function () {

  window.respostasAcerto_objetos = [
    'dinamite', 'munhequeira', 'impressora', 'pano', 'barbeador',  'celular', 'pandeiro', 'estilingue', 'compasso',  'cal√ßadeira', 'churrasqueira',
    "pneu",
    "leque",
    "l√°pis", "bilhete", "ratoeira",
    "lapiseira", "escapamento", "cadar√ßo",
    "apontador de l√°pis", "retrovisor", "isqueiro",
    "spray", "torpedo", "presilha", "biqu√≠ni",
    "bon√©", "extintor de inc√™ndio",
    "chap√©u", "frigobar",
    "capacete", "est√°tua", "estatueta do oscar",
    "chave de roda",
    "tijolo", "bengala",
    "brilho labial",
    "l√°pis de olho",
    "delineador", "despertador",
    "l√°pis labial", "guindaste",
    "cueca",
    "sunga",
    "vestido",
    "lumin√°ria",
    "cal√ßa",
    "bermuda",
    "cinto",
    "viol√£o", "viola",
    "gaita",
    "trompete",
    "radar",
    "rimel",
    "esparadrapo",
    "colch√£o", "cita-liga",
    "travesseiro",
    "fruteira", "fritadeira el√©trica",
    "crach√°",
    "meia",
    "sapato",
    "taco",
    "dado",
    "domin√≥",
    "guarda-roupa",
    "la√ßo",
    "palito de f√≥sforo",
    "apito",
    "fantasia",
    "lantejoula",
    "caixa registradora",
    "l√¢mpada",
    "lamparina",
    "desentupidor",
    "marcador de texto",
    "bandeja",
    "coador",
    "cartucho de tinta",
    "multiprocessador",
    "pistola",
    "corrente",
    "minissaia",
    "pulseira",
    "alian√ßa",
    "espremedor de frutas",
    "multiprocessador",
    "cd",
    "p√°",
    "aro",
    "ba√∫",
    "dvd",
    "fax", "jornal", "tri√¢ngulo",
    "fio",
    "giz",
    "√≠m√£", "uniforme",
    "pia",
    "v√©u",
    "arco",
    "base",
    "bata",
    "beca",
    "bid√™",
    "b√≥ia",
    "bola",
    "bota",
    "cabo",
    "cama",
    "cano",
    "capa",
    "cera", "confete",
    "chip",
    "clip",
    "cola",
    "cone",
    "cruz",
    "cuia",
    "div√£",
    "elmo",
    "fita",
    "gibi",
    "grua",
    "iate",
    "ioi√¥",
    "lata",
    "leme",
    "lira",
    "lona",
    "luva",
    "maca",
    "mai√¥",
    "mala",
    "mesa",
    "mola",
    "oboe",
    "odre",
    "pino",
    "pipa",
    "pote",
    "puff",
    "rack",
    "ralo",
    "rede",
    "remo",
    "roda",
    "rodo",
    "saia",
    "sino",
    "sof√°",
    "ta√ßa",
    "tear",
    "urna",
    "vaso",
    "vela",
    "xale",
    "√°paco",
    "adaga",
    "alz√£o",
    "√°lbum",
    "anzol",
    "arp√£o",
    "baixo",
    "bal√£o",
    "balsa",
    "banjo",
    "batom",
    "ber√ßo",
    "blusa",
    "blush",
    "boina",
    "bolsa",
    "bomba",
    "bot√£o",
    "broca",
    "bucha",
    "buqu√™",
    "burca",
    "caixa",
    "canga",
    "canoa",
    "carta",
    "cesta",
    "cetro",
    "cocar",
    "chave",
    "clava",
    "cocar",
    "cofre",
    "coifa",
    "conga",
    "corda",
    "cu√≠ca",
    "dardo",
    "dedal",
    "disco",
    "draga",
    "fac√£o",
    "farda",
    "fog√£o",
    "foice",
    "forma",
    "forno",
    "funil",
    "fuzil",
    "ganz√°",
    "garfo",
    "gesso",
    "gorro",
    "harpa",
    "jarra",
    "jeans",
    "kunai",
    "laqu√™",
    "len√ßo",
    "lente",
    "livro",
    "lousa",
    "manta",
    "modem",
    "moeda",
    "motor",
    "mouse",
    "mural",
    "ofur√¥",
    "org√£o",
    "papel",
    "papel higi√™nico",
    "parca",
    "pasta",
    "pedal",
    "pente", "pen drive",
    "piano",
    "pil√£o",
    "pin√ßa",
    "pires",
    "placa",
    "pluma",
    "p√≥dio",
    "porta",
    "prato",
    "prego", "pregador",
    "quepe",
    "r√°dio",
    "r√©dea",
    "r√©gua",
    "rifle",
    "r√≠mel",
    "rolha",
    "sabre",
    "serra",
    "short",
    "t√°bua",
    "talco",
    "tampa",
    "tanga",
    "telha",
    "t√™nis",
    "terno",
    "tiara",
    "toldo",
    "touca",
    "trave",
    "trono",
    "tumba",
    "varal",
    "vidro",
    "viol√£o",
    "webcam",
    "x√≠cara",
    "abajur",
    "agenda",
    "agulha",
    "alarme",
    "ala√∫de",
    "aljava",
    "√¢ncora",
    "anilha",
    "antena",
    "balaio", "brinquedo",
    "barril",
    "bast√£o",
    "batina",
    "batuta",
    "bomba",
    "boneca",
    "bornal",
    "botina",
    "brinco",
    "broche",
    "buzina",
    "cabide", "v√≠deo game",
    "caix√£o",
    "cajado",
    "c√°lice",
    "calota",
    "camisa",
    "caneca",
    "cantil",
    "canudo",
    "capelo",
    "cart√£o",
    "casaco",
    "caxixi",
    "concha",
    "di√°rio",
    "domin√≥",
    "enxada",
    "escova",
    "escudo",
    "espada",
    "espeto",
    "estaca",
    "estojo",
    "fagote",
    "fivela",
    "flauta",
    "flecha",
    "form√£o",
    "frasco",
    "fronha",
    "gaiola",
    "gancho",
    "gaveta",
    "grelha",
    "h√©lice",
    "jaleco",
    "janela", "lanterna chinesa",
    "lajota",
    "l√¢mina",
    "len√ßol",
    "luneta",
    "lustre",
    "marac√°",
    "mastro",
    "m√≠ssil",
    "√≥culos",
    "pacote",
    "palet√≥",
    "panela",
    "papete",
    "p√©rola",
    "peruca",
    "peteca",
    "pijama",
    "pincel",
    "pipeta",
    "planta",
    "pomada",
    "poster",
    "punhal",
    "quadro",
    "rabeca",
    "rodap√©",
    "sapato",
    "sirene",
    "sombra",
    "su√©ter",
    "talher",
    "tambor", "tamborim",
    "tanque",
    "tapete",
    "tatame",
    "tecido",
    "tigela",
    "toalha",
    "trof√©u",
    "trompa",
    "t√∫nica",
    "violoncelo",
    "acetona",
    "alicate",
    "bobina",
    "andador",
    "arm√°rio",
    "balan√ßo",
    "bandolim",
    "barraca",
    "bateria",
    "cadeado",
    "cadeira",
    "caderno",
    "caixote",
    "controle remoto",
    "escorregador",
    "estetosc√≥pio",
    "filtro de √°gua",
    "fita isolante",
    "guarda-chuva",
    "guarda-sol",
    "metr√¥",
    "micro-ondas",
    "microfone",
    "m√°quina fotogr√°fica",
    "m√°quina de lavar",
    "televis√£o",
    "ventilador",
    "torradeira",
    "term√¥metro",
    "telesc√≥pio",
  ];

  window.respostasAcerto_alimentos = [
    "ch√°",
    "mel",
    "ovo",
    "p√£o",
    "rum",
    "sal",
    "uva",
    "abiu",
    "a√ßa√≠",
    "√°gua",
    "aipo",
    "alho",
    "angu",
    "bala",
    "bife",
    "bolo",
    "broa",
    "caf√©",
    "caj√°",
    "caju",
    "coco",
    "figo",
    "fil√©",
    "flan",
    "fub√°",
    "gema",
    "ing√°",
    "jaca",
    "jil√≥",
    "kiwi",
    "lima",
    "ma√ß√£",
    "mate",
    "nabo",
    "√≥leo",
    "pat√™",
    "pav√™",
    "pera",
    "pur√™",
    "rom√£",
    "sagu",
    "soja",
    "sopa",
    "suco",
    "umbu",
    "aipim",
    "amora",
    "ara√ßa",
    "arroz",
    "aveia",
    "avel√£",
    "bacon",
    "bauru",
    "cacau",
    "caqui",
    "carne",
    "chopp",
    "cidra",
    "clara",
    "couve",
    "cravo",
    "crepe",
    "curau",
    "curry",
    "glac√™",
    "jambo",
    "jata√≠",
    "leite",
    "licor",
    "lim√£o",
    "lombo",
    "louro",
    "mam√£o",
    "manga",
    "mel√£o",
    "menta",
    "milho",
    "nozes",
    "orob√¥",
    "pequi",
    "pinha",
    "pir√£o",
    "pizza",
    "pudim",
    "quibe",
    "ra√ß√£o",
    "salsa",
    "saqu√™",
    "sonho",
    "sufl√™",
    "sushi",
    "torta",
    "trigo",
    "trufa",
    "vagem",
    "vinho",
    "vodca",
    "abric√≥",
    "acelga",
    "a√ß√∫car",
    "agri√£o",
    "alface",
    "ameixa",
    "azeite",
    "bacuri",
    "banana",
    "batata",
    "batida",
    "bombom",
    "canap√©",
    "canela",
    "caruru",
    "caviar",
    "cebola",
    "cereal",
    "cereja",
    "chuchu",
    "cocada",
    "cuscuz",
    "empada",
    "farofa",
    "feij√£o",
    "fondue",
    "frango",
    "funghi",
    "garapa",
    "geleia",
    "goiaba",
    "guandu",
    "h√≥stia",
    "inhame",
    "jatob√°",
    "jujuba",
    "lichia",
    "manjar",
    "maxixe",
    "mingau",
    "mousse",
    "muffin",
    "murici",
    "nachos",
    "nhoque",
    "pa√ßoca",
    "pastel",
    "pepino",
    "pernil",
    "picles",
    "picol√©",
    "pinh√£o",
    "pipoca",
    "pitaya",
    "queijo",
    "quiabo",
    "rabada",
    "ricota",
    "r√∫cula",
    "salada",
    "salame",
    "sals√£o",
    "sapoti",
    "sundae",
    "t√¢mara",
    "temaki",
    "tomate",
    "u√≠sque",
    "urucum",
    "vatap√°",
    "abacate",
    "abacaxi",
    "ab√≥bora",
    "acaraj√©",
    "acerola",
    "alecrim",
    "alfajor",
    "am√™ndoa",
    "aspargo",
    "atem√≥ia",
    "a√ßafr√£o",
    "baguete",
    "beirute",
    "bisteca",
    "bolacha",
    "brioche",
    "cambuc√°",
    "canjica",
    "cenoura",
    "cerveza",
    "churros",
    "coentro",
    "colorau",
    "cookies",
    "costela",
    "coxinha",
    "cupcake",
    "damasco",
    "empad√£o",
    "end√≠via",
    "ervilha",
    "esfirra",
    "granola",
    "guaran√°",
    "hortel√£",
    "iogurte",
    "ketchup",
    "laranja",
    "lasanha",
    "mangaba",
    "marisco",
    "mirtilo",
    "moranga",
    "morango",
    "m√∫sculo",
    "nuggets",
    "omelete",
    "or√©gano",
    "palmito",
    "pamonha",
    "p√£o de l√≥",
    "picanha",
    "pimenta",
    "polenta",
    "quindim",
    "ravioli",
    "repolho",
    "risoles",
    "sashimi",
    "suspiro",
    "tapioca",
    "tequila",
    "torrada",
    "torrone",
    "vinagre",
    "waffles",
    "ado√ßante",
    "amendoim",
    "azeitona",
    "biscoito",
    "br√≥colis",
    "croquete",
    "feijoada",
    "gelatina",
    "gengibre",
    "goiabada",
    "limonada",
    "macarr√£o",
    "maionese",
    "mandioca",
    "maracuj√°",
    "melancia",
    "merengue",
    "mostarda",
    "panetone",
    "panqueca",
    "parmes√£o",
    "pirulito",
    "pistache",
    "presunto",
    "r√°dio",
    "raspberry",
    "salpic√£o",
    "sequilho",
    "talharim",
    "torresmo",
    "tortilla",
    "uva passa",
    "vitamina",
    "yakisoba",
    "brigadeiro",
    "caipirinha",
    "cheesecake",
    "dobradinha",
    "energ√©tico",
    "gorgonzola",
    "hamb√∫rguer",
    "jabuticaba",
    "manjeric√£o",
    "mousse de maracuj√°",
    "p√£o de queijo",
    "petit g√¢teau",
    "suco de ma√ß√£",
    "vinho branco",
    "abacaxi",
    "doce de leite",
    "feij√£o preto",
    "leite de coco",
    "marshmallow",
    "panqueca",
    "torta de lim√£o",
  ];

  window.respostasAcerto_animais = [];

  window.desenhoCancelado = false;
  window.acertou = false;
  window.tentativasDesenhoAtual = [];

  const respostasSelector = "#respostas .historico .lista";
  const chatSelector = "#chat .historico .lista";
  const storedKey = "gartic_chat_log";
  const boxId = "gartic-float-box";

  function main() {
    // limparMensagensGartic();

    // In√≠cio
    const chatTargetNode = document.querySelector(chatSelector);
    const respostasTargetNode = document.querySelector(respostasSelector);
    if (chatTargetNode && respostasTargetNode) {
      

      // iniciar com chat
      if(false){
        criarChat();
      }

      window._garticChatObserver.observe(chatTargetNode, { childList: true });
      window._garticRespostaObserver.observe(respostasTargetNode, {
        childList: true,
      });
      console.log(
        "%c[Gartic] Iniciado. Monitorando chat, respostas reveladas + janela flutuante ativa.",
        "color: green"
      );
    } else {
      console.warn("[Gartic Chat Log] Chat n√£o encontrado.");
    }
  }

  function sleep(ms) {
    return new Promise((resolve) => {
      setTimeout(resolve, ms);
    });
  }

  function dicaParaRegex(dica) {
    // Divide por espa√ßos para suportar frases com m√∫ltiplas palavras
    const palavras = dica.trim().split(" ");
    const regexPalavras = palavras.map((palavra) => {
      // Substitui cada 'x' por '.', mantendo as letras vis√≠veis
      return palavra.replace(/x/g, ".");
    });
    // Junta as partes com espa√ßo e retorna uma regex completa com ^ e $
    return new RegExp("^" + regexPalavras.join(" ") + "$", "i");
  }

  function filtrarPorDica(dica, lista) {
    const regex = dicaParaRegex(dica);
    return lista.filter((palavra) => regex.test(palavra));
  }

  // Utilit√°rio: salva no localStorage
  const saveChatLog = (log) => {
    localStorage.setItem(storedKey, JSON.stringify(log));
  };

  // Recupera hist√≥rico salvo
  let chatLog = JSON.parse(localStorage.getItem(storedKey)) || [];

  // Cria janela flutuante
  const createFloatingBox = () => {
    if (document.getElementById(boxId)) return;

    const box = document.createElement("div");
    box.id = boxId;
    box.style.position = "fixed";
    box.style.top = "10px";
    box.style.left = "10px";
    box.style.width = "300px";
    box.style.height = "300px";
    box.style.overflow = "hidden";
    box.style.backgroundColor = "rgba(0,0,0,0.9)";
    box.style.color = "#fff";
    box.style.fontSize = "16px";
    box.style.padding = "10px";
    box.style.zIndex = "9999";
    box.style.border = "1px solid #ccc";
    box.style.borderRadius = "5px";
    box.style.fontFamily = "monospace";
    box.style.display = "flex";
    box.style.flexDirection = "column";
    box.style.gap = "5px";

    // Header
    const header = document.createElement("div");
    header.textContent = " - Gartic Bot - ".concat(`(${getTipoSala()})`);
    header.style.fontWeight = "bold";
    header.style.fontSize = "20px";
    header.style.marginBottom = "8px";
    header.style.textAlign = "center";
    header.style.cursor = "move"; // Cursor de arrastar
    header.style.userSelect = "none";
    box.appendChild(header);

    // area dos botoes 1 
    const buttonDiv1 = document.createElement("div");
    buttonDiv1.style.backgroundColor = "";
    buttonDiv1.style.height = "40px";
    buttonDiv1.style.display = "flex";
    buttonDiv1.style.gap = "5px";

    // area dos botoes 2
    const buttonDiv2 = document.createElement("div");
    buttonDiv2.style.backgroundColor = "";
    buttonDiv2.style.height = "40px";
    buttonDiv2.style.display = "flex";
    buttonDiv2.style.gap = "5px";

    // botao ativar anti iddle
    const button1d1 = document.createElement("button");
    button1d1.textContent = "Ativar Anti Iddle"
    button1d1.addEventListener("click", (e) => {
      window.ativarAntiIdle()
    })

    // botao desativar anti iddle
    const button2d1 = document.createElement("button");
    button2d1.textContent = "Desativar Anti Iddle"
    button2d1.addEventListener("click", () => {
      window.desativarAntiIdle()
    })

        // botao ativar anti iddle
    const button1d2 = document.createElement("button");
    button1d2.textContent = "Tentar Acerto"
    button1d2.addEventListener("click", () => {
      window.tentarAcerto()
    })

    // botao desativar anti iddle
    const button2d2 = document.createElement("button");
    button2d2.textContent = "Parar tentar acerto"
    button2d2.addEventListener("click", () => {
      window.pararTentarAcerto()
    })

    buttonDiv1.append(button1d1, button2d1);
    buttonDiv2.append(button1d2, button2d2);

    box.append(buttonDiv1, buttonDiv2);



    // T√≠tulo
    const title = document.createElement("div");
    title.textContent = "üìú Hist√≥rico do Chat";
    title.style.fontWeight = "bold";
    title.style.marginBottom = "8px";
    title.style.textAlign = "center";
    // title.style.cursor = "move"; // Cursor de arrastar
    title.style.userSelect = "none";
    box.appendChild(title);

    header.addEventListener("mousedown", function (e) {
      e.preventDefault();
      let offsetX = e.clientX - box.offsetLeft;
      let offsetY = e.clientY - box.offsetTop;

      const onMouseMove = (e) => {
        box.style.left = e.clientX - offsetX + "px";
        box.style.top = e.clientY - offsetY + "px";
      };

      const onMouseUp = () => {
        document.removeEventListener("mousemove", onMouseMove);
        document.removeEventListener("mouseup", onMouseUp);
      };

      document.addEventListener("mousemove", onMouseMove);
      document.addEventListener("mouseup", onMouseUp);
    });

    // Conte√∫do
    const content = document.createElement("div");
    content.id = "gartic-float-content";
    content.style.flex = "1";
    content.style.overflowY = "auto";
    box.appendChild(content);

    // Resizer (canto inferior direito)
    const resizer = document.createElement("div");
    resizer.style.width = "10px";
    resizer.style.height = "10px";
    resizer.style.position = "absolute";
    resizer.style.right = "0";
    resizer.style.bottom = "0";
    resizer.style.cursor = "nwse-resize";
    resizer.style.background = "transparent"; // pode deixar vis√≠vel se quiser
    box.appendChild(resizer);

    // Redimensionamento (horizontal e vertical)
    resizer.addEventListener(
      "mousedown",
      function (e) {
        e.preventDefault();
        const startX = e.clientX;
        const startY = e.clientY;
        const startWidth = parseInt(
          document.defaultView.getComputedStyle(box).width,
          10
        );
        const startHeight = parseInt(
          document.defaultView.getComputedStyle(box).height,
          10
        );

        const doDrag = function (e) {
          box.style.width = startWidth + e.clientX - startX + "px";
          box.style.height = startHeight + e.clientY - startY + "px";
        };

        const stopDrag = function () {
          document.documentElement.removeEventListener(
            "mousemove",
            doDrag,
            false
          );
          document.documentElement.removeEventListener(
            "mouseup",
            stopDrag,
            false
          );
        };

        document.documentElement.addEventListener("mousemove", doDrag, false);
        document.documentElement.addEventListener("mouseup", stopDrag, false);
      },
      false
    );

    document.body.appendChild(box);

    // Preenche com hist√≥rico
    chatLog.forEach((msg) => appendMessageToBox(msg));
  };

  // Adiciona uma mensagem na caixa flutuante
  const appendMessageToBox = ({ name, text }) => {
    const container = document.getElementById("gartic-float-content");
    if (!container) return;

    const line = document.createElement("div");
    line.style.marginTop = "5px";
    line.textContent = `${name}: ${text}`;
    container.appendChild(line);

    // Scroll para o final
    container.scrollTop = container.scrollHeight;
  };

  // Extrai info da mensagem
  const extractMessageData = (div) => {
    const strong = div.querySelector("strong");
    if (!strong) return null;

    const name = strong.textContent.trim();
    const text = div.textContent.replace(name, "").trim();

    return { name, text, timestamp: new Date().toISOString() };
  };

  // Observa novas mensagens
  if (window._garticChatObserver) {
    window._garticChatObserver.disconnect();
    console.log("[Gartic Chat Log] Observer anterior desligado.");
  } else {
    window._garticChatObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
          if (node.nodeType === 1) {
            const data = extractMessageData(node);
            if (data) {
              const isDuplicate = chatLog.some(
                (entry) => entry.name === data.name && entry.text === data.text
              );

              if (!isDuplicate) {
                chatLog.push(data);
                saveChatLog(chatLog);
                appendMessageToBox(data);
              }
            }
          }
        });
      });
    });
  }

  // observa novas respostas corretas
  if (window._garticRespostaObserver) {
    window._garticRespostaObserver.disconnect();
    console.log("[Gartic] Observer anterior desligado.");
  } else {
    window._garticRespostaObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
          if (node.nodeType !== 1) return; // ignora se n√£o for elemento

          // Verifica se √© uma mensagem do sistema
          if (
            node.classList.contains("sistema") &&
            node.textContent.includes("A resposta era")
          ) {
            const palavra = node.querySelector("strong")?.textContent.trim();
            if (palavra) {
              console.log("[Gartic] Resposta detectada:", palavra);

              // Se quiser salvar em um array global
              if (!window.respostasReveladas) window.respostasReveladas = [];
              window.respostasReveladas.push(palavra);

              const exists = window.respostasAcerto_objetos.indexOf(palavra);
              if (exists == "-1") {
                window.respostasAcerto_objetos.push(palavra);
              }
            }
          }

          // verifica se o desenho foi cancelado
          if (
            node.classList.contains("sistema") &&
            node.textContent.includes("Desenho cancelado")
          ) {
            console.log("[Gartic] Desenho terminou.");
            window.desenhoCancelado = true;
          }
          // verifica se o desenho foi cancelado
          if (
            node.classList.contains("sistema") &&
            node.textContent.includes("Intervalo")
          ) {
            console.log("[Gartic] Desenho terminou.");
            window.desenhoCancelado = true;
            window.tentativasDesenhoAtual = [];
          }
          // verifica acerto
          if (
            node.classList.contains("acerto") &&
            node.textContent.includes("Voc√™ acertou")
          ) {
            console.log("[Gartic] Acertou o desenho.");
            window.acertou = true;
          }
        });
      });
    });
  }


  // Comandos √∫teis no console
  window.verMensagensGartic = () => {
    console.table(chatLog);
    return chatLog;
  };

  window.limparMensagensGartic = () => {
    chatLog = [];
    saveChatLog(chatLog);
    const container = document.getElementById("gartic-float-content");
    if (container) container.innerHTML = "";
    console.log("[Gartic Chat Log] Hist√≥rico limpo.");
  };

  window.removerChat = () => {
    const el = document.getElementById("gartic-float-box");
    if (el) el.remove();
    console.log("chat removido");
  };

  window.criarChat = () => {
    console.log("chat criado");
    createFloatingBox();
  }

  window.obterDica = () => {
    // Seleciona spans de tra√ßos e espa√ßos
    const spans = document.querySelectorAll(".dicaTxt .traco, .dicaTxt .espaco");

    let dica = "";
    spans.forEach((span) => {
      if (span.classList.contains("espaco")) {
        dica += " "; // espa√ßo entre palavras
      } else {
        dica += span.innerHTML === "&nbsp;" || span.textContent.trim() === "" ? "_" : span.textContent;
      }
    });

    return dica;
  };

  // pega a dica formatada com x no lugar dos espa√ßos em branco
  window.obterDicaFormatada = () => {
    // Seleciona spans ativos + espa√ßos
    const spans = document.querySelectorAll(".dicaAtual .traco.ativo, .dicaAtual .espaco");

    let dicaFormatada = "";
    spans.forEach((span) => {
      if (span.classList.contains("espaco")) {
        dicaFormatada += " "; // mant√©m espa√ßo entre palavras
      } else {
        dicaFormatada += (span.innerHTML === "&nbsp;" || span.textContent.trim() === "") 
          ? "x" 
          : span.textContent;
      }
    });

    return dicaFormatada;
  };

  window.darResposta = (resposta) => {
    // document.querySelector('#respostas form input').value
    const input = document.querySelector("#respostas form input");
    input.value = resposta;

    if(!tentativasDesenhoAtual.includes(resposta)){
      tentativasDesenhoAtual.push(resposta);
    }

    const form = document.querySelector("#respostas form");
    form.dispatchEvent(
      new Event("submit", { bubbles: true, cancelable: true })
    );
  };

  window.tentarAcerto = async () => {
    // reseta as flags globais
    window.desenhoCancelado = false;
    window.acertou = false;

    const dica = obterDicaFormatada();
    const tipo = getTipoSala();
    console.log("voce esta jogando em: ", {tipo, dica});
    let resposta;
    if (!dica) {
      switch (tipo) {
        case "objetos":
          resposta =
            window.respostasAcerto_objetos[
              Math.floor(Math.random() * window.respostasAcerto_objetos.length)
            ];
          break;

        case "animais":
          resposta =
            window.respostasAcerto_animais[
              Math.floor(Math.random() * window.respostasAcerto_animais.length)
            ];
          break;

        case "alimentos":
          resposta =
            window.respostasAcerto_alimentos[
              Math.floor(
                Math.random() * window.respostasAcerto_alimentos.length
              )
            ];
          break;

        case "geral":
          break;
      }

      console.log("A dica √©, ", dica)
      console.log("[Gartic Bot] Resposta aleatoria:", resposta);
      if (resposta) {

        if(!tentativasDesenhoAtual.includes(resposta)){
          darResposta(resposta);
        }else{
          console.log(`A resposta: ${resposta}, ja foi dada no desenho atual`);
        }
      }
      return;
    }

    switch (tipo) {
      case "objetos":
        resposta = filtrarPorDica(dica, window.respostasAcerto_objetos);
        break;

      case "animais":
        resposta = filtrarPorDica(dica, window.respostasAcerto_animais);
        break;

      case "alimentos":
        resposta = filtrarPorDica(dica, window.respostasAcerto_alimentos);
        break;

      case "geral":
        break;
    }

    console.log("resposta por dica", {dica, resposta});
    if (resposta.length) {
      // darResposta(resposta[0]);
      for (const resultado of resposta) {
        if (window.desenhoCancelado || window.acertou) {
          console.log("[Gartic Bot] Tentativas pausadas: desenho terminou.");
          break;
        }
        if (resultado) {
          console.log("[Gartic Bot] Resposta enviada:", resultado);
          if(!tentativasDesenhoAtual.includes(resultado)){
            darResposta(resultado);
          } else {
            console.log(`A resposta: ${resultado}, ja foi dada no desenho atual`);
          }
          // darResposta(resultado);
          await sleep(500);
        }
      }
      return;
    }
    if (resposta) {
      darResposta(resposta);
    }
    return;
  };

  window.forcarAcerto = async () => {
    window.desenhoCancelado = false;

    const dica = obterDicaFormatada();
    let resultados;

    if (dica) {
      resultados = filtrarPorDica(dica, respostas);
    } else {
      resultados = window.respostasAcerto_objetos;
    }

    for (const resultado of resultados) {
      if (window.desenhoCancelado || window.acertou) {
        console.log("[Gartic Bot] Tentativas pausadas: desenho terminou.");
        break;
      }
      darResposta(resultado);
      await sleep(500);
    }
  };

  window.pararTentarAcerto = () => {
    window.acertou = true;
  }

  window.obterRespostasReveladas = () => {
    // pegar apenas as respostas que nao contenham nos objetos do arquivo
    const tipo = getTipoSala();

    console.log("respostas", window.respostasReveladas);

    return window.respostasReveladas;

    let resultado;
    switch (tipo) {
      case "objetos":
        resultado = window.respostasReveladas.filter(
          (p) => !window.respostasAcerto_objetos.includes(p)
        );
        break;
      case "animais":
        resultado = window.respostasReveladas.filter(
          (p) => !window.respostasAcerto_animais.includes(p)
        );
        break;
      case "alimentos":
        resultado = window.respostasReveladas.filter(
          (p) => !window.respostasAcerto_alimentos.includes(p)
        );
        break;
      case "geral":
        break;
    }
    if (resultado) {
      return resultado;
    }
    return [];
  };

  window.todasRespostas = () => {
    return window.respostasAcerto_objetos;
  };

  // objeto | alimento | geral
  window.getTipoSala = () => {
    return document.title.split(" ")[0].toLocaleLowerCase();
  };


  window.isAntiIdle = false;
  window._antiIdleInterval = null;
  window.ativarAntiIdle = (delay = 5000) => {
    if (window._antiIdleInterval) {
      clearInterval(window._antiIdleInterval); // garante que n√£o fica res√≠duo
    }

    window.isAntiIdle = true;
    window._antiIdleInterval = setInterval(() => {
      const botaoOk = document.querySelector("#popupBt1");
      if (botaoOk) {
        botaoOk.click();
        console.log("AntiIdle: OK!");
      }
    }, delay);

    console.log("AntiIdle ativado!");
  };

  window.desativarAntiIdle = () => {
    if (!window.isAntiIdle || !window._antiIdleInterval) return; // j√° est√° desativado

    clearInterval(window._antiIdleInterval);
    window._antiIdleInterval = null;
    window.isAntiIdle = false;
    console.log("AntiIdle desativado!");
  };

  main();
})();
