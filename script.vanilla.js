(function () {

  window.respostasAcerto_objetos = [
    'dinamite', 'munhequeira', 'impressora', 'pano', 'barbeador',  'celular', 'pandeiro', 'estilingue', 'compasso',  'calçadeira', 'churrasqueira',
    "pneu",
    "leque",
    "lápis", "bilhete", "ratoeira",
    "lapiseira", "escapamento", "cadarço",
    "apontador de lápis", "retrovisor", "isqueiro",
    "spray", "torpedo", "presilha", "biquíni",
    "boné", "extintor de incêndio",
    "chapéu", "frigobar",
    "capacete", "estátua", "estatueta do oscar",
    "chave de roda",
    "tijolo", "bengala",
    "brilho labial",
    "lápis de olho",
    "delineador", "despertador",
    "lápis labial", "guindaste",
    "cueca",
    "sunga",
    "vestido",
    "luminária",
    "calça",
    "bermuda",
    "cinto",
    "violão", "viola",
    "gaita",
    "trompete",
    "radar",
    "rimel",
    "esparadrapo",
    "colchão", "cita-liga",
    "travesseiro",
    "fruteira", "fritadeira elétrica",
    "crachá",
    "meia",
    "sapato",
    "taco",
    "dado",
    "dominó",
    "guarda-roupa",
    "laço",
    "palito de fósforo",
    "apito",
    "fantasia",
    "lantejoula",
    "caixa registradora",
    "lâmpada",
    "lamparina",
    "desentupidor",
    "marcador de texto",
    "bandeja",
    "coador",
    "cartucho de tinta",
    "multiprocessador",
    "pistola",
    "corrente",
    "minissaia",
    "pulseira",
    "aliança",
    "espremedor de frutas",
    "multiprocessador",
    "cd",
    "pá",
    "aro",
    "baú",
    "dvd",
    "fax", "jornal", "triângulo",
    "fio",
    "giz",
    "ímã", "uniforme",
    "pia",
    "véu",
    "arco",
    "base",
    "bata",
    "beca",
    "bidê",
    "bóia",
    "bola",
    "bota",
    "cabo",
    "cama",
    "cano",
    "capa",
    "cera", "confete",
    "chip",
    "clip",
    "cola",
    "cone",
    "cruz",
    "cuia",
    "divã",
    "elmo",
    "fita",
    "gibi",
    "grua",
    "iate",
    "ioiô",
    "lata",
    "leme",
    "lira",
    "lona",
    "luva",
    "maca",
    "maiô",
    "mala",
    "mesa",
    "mola",
    "oboe",
    "odre",
    "pino",
    "pipa",
    "pote",
    "puff",
    "rack",
    "ralo",
    "rede",
    "remo",
    "roda",
    "rodo",
    "saia",
    "sino",
    "sofá",
    "taça",
    "tear",
    "urna",
    "vaso",
    "vela",
    "xale",
    "ápaco",
    "adaga",
    "alzão",
    "álbum",
    "anzol",
    "arpão",
    "baixo",
    "balão",
    "balsa",
    "banjo",
    "batom",
    "berço",
    "blusa",
    "blush",
    "boina",
    "bolsa",
    "bomba",
    "botão",
    "broca",
    "bucha",
    "buquê",
    "burca",
    "caixa",
    "canga",
    "canoa",
    "carta",
    "cesta",
    "cetro",
    "cocar",
    "chave",
    "clava",
    "cocar",
    "cofre",
    "coifa",
    "conga",
    "corda",
    "cuíca",
    "dardo",
    "dedal",
    "disco",
    "draga",
    "facão",
    "farda",
    "fogão",
    "foice",
    "forma",
    "forno",
    "funil",
    "fuzil",
    "ganzá",
    "garfo",
    "gesso",
    "gorro",
    "harpa",
    "jarra",
    "jeans",
    "kunai",
    "laquê",
    "lenço",
    "lente",
    "livro",
    "lousa",
    "manta",
    "modem",
    "moeda",
    "motor",
    "mouse",
    "mural",
    "ofurô",
    "orgão",
    "papel",
    "papel higiênico",
    "parca",
    "pasta",
    "pedal",
    "pente", "pen drive",
    "piano",
    "pilão",
    "pinça",
    "pires",
    "placa",
    "pluma",
    "pódio",
    "porta",
    "prato",
    "prego", "pregador",
    "quepe",
    "rádio",
    "rédea",
    "régua",
    "rifle",
    "rímel",
    "rolha",
    "sabre",
    "serra",
    "short",
    "tábua",
    "talco",
    "tampa",
    "tanga",
    "telha",
    "tênis",
    "terno",
    "tiara",
    "toldo",
    "touca",
    "trave",
    "trono",
    "tumba",
    "varal",
    "vidro",
    "violão",
    "webcam",
    "xícara",
    "abajur",
    "agenda",
    "agulha",
    "alarme",
    "alaúde",
    "aljava",
    "âncora",
    "anilha",
    "antena",
    "balaio", "brinquedo",
    "barril",
    "bastão",
    "batina",
    "batuta",
    "bomba",
    "boneca",
    "bornal",
    "botina",
    "brinco",
    "broche",
    "buzina",
    "cabide", "vídeo game",
    "caixão",
    "cajado",
    "cálice",
    "calota",
    "camisa",
    "caneca",
    "cantil",
    "canudo",
    "capelo",
    "cartão",
    "casaco",
    "caxixi",
    "concha",
    "diário",
    "dominó",
    "enxada",
    "escova",
    "escudo",
    "espada",
    "espeto",
    "estaca",
    "estojo",
    "fagote",
    "fivela",
    "flauta",
    "flecha",
    "formão",
    "frasco",
    "fronha",
    "gaiola",
    "gancho",
    "gaveta",
    "grelha",
    "hélice",
    "jaleco",
    "janela", "lanterna chinesa",
    "lajota",
    "lâmina",
    "lençol",
    "luneta",
    "lustre",
    "maracá",
    "mastro",
    "míssil",
    "óculos",
    "pacote",
    "paletó",
    "panela",
    "papete",
    "pérola",
    "peruca",
    "peteca",
    "pijama",
    "pincel",
    "pipeta",
    "planta",
    "pomada",
    "poster",
    "punhal",
    "quadro",
    "rabeca",
    "rodapé",
    "sapato",
    "sirene",
    "sombra",
    "suéter",
    "talher",
    "tambor", "tamborim",
    "tanque",
    "tapete",
    "tatame",
    "tecido",
    "tigela",
    "toalha",
    "troféu",
    "trompa",
    "túnica",
    "violoncelo",
    "acetona",
    "alicate",
    "bobina",
    "andador",
    "armário",
    "balanço",
    "bandolim",
    "barraca",
    "bateria",
    "cadeado",
    "cadeira",
    "caderno",
    "caixote",
    "controle remoto",
    "escorregador",
    "estetoscópio",
    "filtro de água",
    "fita isolante",
    "guarda-chuva",
    "guarda-sol",
    "metrô",
    "micro-ondas",
    "microfone",
    "máquina fotográfica",
    "máquina de lavar",
    "televisão",
    "ventilador",
    "torradeira",
    "termômetro",
    "telescópio",
  ];

  window.respostasAcerto_alimentos = [
    "chá",
    "mel",
    "ovo",
    "pão",
    "rum",
    "sal",
    "uva",
    "abiu",
    "açaí",
    "água",
    "aipo",
    "alho",
    "angu",
    "bala",
    "bife",
    "bolo",
    "broa",
    "café",
    "cajá",
    "caju",
    "coco",
    "figo",
    "filé",
    "flan",
    "fubá",
    "gema",
    "ingá",
    "jaca",
    "jiló",
    "kiwi",
    "lima",
    "maçã",
    "mate",
    "nabo",
    "óleo",
    "patê",
    "pavê",
    "pera",
    "purê",
    "romã",
    "sagu",
    "soja",
    "sopa",
    "suco",
    "umbu",
    "aipim",
    "amora",
    "araça",
    "arroz",
    "aveia",
    "avelã",
    "bacon",
    "bauru",
    "cacau",
    "caqui",
    "carne",
    "chopp",
    "cidra",
    "clara",
    "couve",
    "cravo",
    "crepe",
    "curau",
    "curry",
    "glacê",
    "jambo",
    "jataí",
    "leite",
    "licor",
    "limão",
    "lombo",
    "louro",
    "mamão",
    "manga",
    "melão",
    "menta",
    "milho",
    "nozes",
    "orobô",
    "pequi",
    "pinha",
    "pirão",
    "pizza",
    "pudim",
    "quibe",
    "ração",
    "salsa",
    "saquê",
    "sonho",
    "suflê",
    "sushi",
    "torta",
    "trigo",
    "trufa",
    "vagem",
    "vinho",
    "vodca",
    "abricó",
    "acelga",
    "açúcar",
    "agrião",
    "alface",
    "ameixa",
    "azeite",
    "bacuri",
    "banana",
    "batata",
    "batida",
    "bombom",
    "canapé",
    "canela",
    "caruru",
    "caviar",
    "cebola",
    "cereal",
    "cereja",
    "chuchu",
    "cocada",
    "cuscuz",
    "empada",
    "farofa",
    "feijão",
    "fondue",
    "frango",
    "funghi",
    "garapa",
    "geleia",
    "goiaba",
    "guandu",
    "hóstia",
    "inhame",
    "jatobá",
    "jujuba",
    "lichia",
    "manjar",
    "maxixe",
    "mingau",
    "mousse",
    "muffin",
    "murici",
    "nachos",
    "nhoque",
    "paçoca",
    "pastel",
    "pepino",
    "pernil",
    "picles",
    "picolé",
    "pinhão",
    "pipoca",
    "pitaya",
    "queijo",
    "quiabo",
    "rabada",
    "ricota",
    "rúcula",
    "salada",
    "salame",
    "salsão",
    "sapoti",
    "sundae",
    "tâmara",
    "temaki",
    "tomate",
    "uísque",
    "urucum",
    "vatapá",
    "abacate",
    "abacaxi",
    "abóbora",
    "acarajé",
    "acerola",
    "alecrim",
    "alfajor",
    "amêndoa",
    "aspargo",
    "atemóia",
    "açafrão",
    "baguete",
    "beirute",
    "bisteca",
    "bolacha",
    "brioche",
    "cambucá",
    "canjica",
    "cenoura",
    "cerveza",
    "churros",
    "coentro",
    "colorau",
    "cookies",
    "costela",
    "coxinha",
    "cupcake",
    "damasco",
    "empadão",
    "endívia",
    "ervilha",
    "esfirra",
    "granola",
    "guaraná",
    "hortelã",
    "iogurte",
    "ketchup",
    "laranja",
    "lasanha",
    "mangaba",
    "marisco",
    "mirtilo",
    "moranga",
    "morango",
    "músculo",
    "nuggets",
    "omelete",
    "orégano",
    "palmito",
    "pamonha",
    "pão de ló",
    "picanha",
    "pimenta",
    "polenta",
    "quindim",
    "ravioli",
    "repolho",
    "risoles",
    "sashimi",
    "suspiro",
    "tapioca",
    "tequila",
    "torrada",
    "torrone",
    "vinagre",
    "waffles",
    "adoçante",
    "amendoim",
    "azeitona",
    "biscoito",
    "brócolis",
    "croquete",
    "feijoada",
    "gelatina",
    "gengibre",
    "goiabada",
    "limonada",
    "macarrão",
    "maionese",
    "mandioca",
    "maracujá",
    "melancia",
    "merengue",
    "mostarda",
    "panetone",
    "panqueca",
    "parmesão",
    "pirulito",
    "pistache",
    "presunto",
    "rádio",
    "raspberry",
    "salpicão",
    "sequilho",
    "talharim",
    "torresmo",
    "tortilla",
    "uva passa",
    "vitamina",
    "yakisoba",
    "brigadeiro",
    "caipirinha",
    "cheesecake",
    "dobradinha",
    "energético",
    "gorgonzola",
    "hambúrguer",
    "jabuticaba",
    "manjericão",
    "mousse de maracujá",
    "pão de queijo",
    "petit gâteau",
    "suco de maçã",
    "vinho branco",
    "abacaxi",
    "doce de leite",
    "feijão preto",
    "leite de coco",
    "marshmallow",
    "panqueca",
    "torta de limão",
  ];

  window.respostasAcerto_animais = [];

  window.desenhoCancelado = false;
  window.acertou = false;
  window.tentativasDesenhoAtual = [];

  const respostasSelector = "#respostas .historico .lista";
  const chatSelector = "#chat .historico .lista";
  const storedKey = "gartic_chat_log";
  const boxId = "gartic-float-box";

  function main() {
    // limparMensagensGartic();

    // Início
    const chatTargetNode = document.querySelector(chatSelector);
    const respostasTargetNode = document.querySelector(respostasSelector);
    if (chatTargetNode && respostasTargetNode) {
      

      // iniciar com chat
      if(false){
        criarChat();
      }

      window._garticChatObserver.observe(chatTargetNode, { childList: true });
      window._garticRespostaObserver.observe(respostasTargetNode, {
        childList: true,
      });
      console.log(
        "%c[Gartic] Iniciado. Monitorando chat, respostas reveladas + janela flutuante ativa.",
        "color: green"
      );
    } else {
      console.warn("[Gartic Chat Log] Chat não encontrado.");
    }
  }

  function sleep(ms) {
    return new Promise((resolve) => {
      setTimeout(resolve, ms);
    });
  }

  function dicaParaRegex(dica) {
    // Divide por espaços para suportar frases com múltiplas palavras
    const palavras = dica.trim().split(" ");
    const regexPalavras = palavras.map((palavra) => {
      // Substitui cada 'x' por '.', mantendo as letras visíveis
      return palavra.replace(/x/g, ".");
    });
    // Junta as partes com espaço e retorna uma regex completa com ^ e $
    return new RegExp("^" + regexPalavras.join(" ") + "$", "i");
  }

  function filtrarPorDica(dica, lista) {
    const regex = dicaParaRegex(dica);
    return lista.filter((palavra) => regex.test(palavra));
  }

  // Utilitário: salva no localStorage
  const saveChatLog = (log) => {
    localStorage.setItem(storedKey, JSON.stringify(log));
  };

  // Recupera histórico salvo
  let chatLog = JSON.parse(localStorage.getItem(storedKey)) || [];

  // Cria janela flutuante
  const createFloatingBox = () => {
    if (document.getElementById(boxId)) return;

    const box = document.createElement("div");
    box.id = boxId;
    box.style.position = "fixed";
    box.style.top = "10px";
    box.style.left = "10px";
    box.style.width = "300px";
    box.style.height = "300px";
    box.style.overflow = "hidden";
    box.style.backgroundColor = "rgba(0,0,0,0.9)";
    box.style.color = "#fff";
    box.style.fontSize = "16px";
    box.style.padding = "10px";
    box.style.zIndex = "9999";
    box.style.border = "1px solid #ccc";
    box.style.borderRadius = "5px";
    box.style.fontFamily = "monospace";
    box.style.display = "flex";
    box.style.flexDirection = "column";
    box.style.gap = "5px";

    // Header
    const header = document.createElement("div");
    header.textContent = " - Gartic Bot - ".concat(`(${getTipoSala()})`);
    header.style.fontWeight = "bold";
    header.style.fontSize = "20px";
    header.style.marginBottom = "8px";
    header.style.textAlign = "center";
    header.style.cursor = "move"; // Cursor de arrastar
    header.style.userSelect = "none";
    box.appendChild(header);

    // area dos botoes 1 
    const buttonDiv1 = document.createElement("div");
    buttonDiv1.style.backgroundColor = "";
    buttonDiv1.style.height = "40px";
    buttonDiv1.style.display = "flex";
    buttonDiv1.style.gap = "5px";

    // area dos botoes 2
    const buttonDiv2 = document.createElement("div");
    buttonDiv2.style.backgroundColor = "";
    buttonDiv2.style.height = "40px";
    buttonDiv2.style.display = "flex";
    buttonDiv2.style.gap = "5px";

    // botao ativar anti iddle
    const button1d1 = document.createElement("button");
    button1d1.textContent = "Ativar Anti Iddle"
    button1d1.addEventListener("click", (e) => {
      window.ativarAntiIdle()
    })

    // botao desativar anti iddle
    const button2d1 = document.createElement("button");
    button2d1.textContent = "Desativar Anti Iddle"
    button2d1.addEventListener("click", () => {
      window.desativarAntiIdle()
    })

        // botao ativar anti iddle
    const button1d2 = document.createElement("button");
    button1d2.textContent = "Tentar Acerto"
    button1d2.addEventListener("click", () => {
      window.tentarAcerto()
    })

    // botao desativar anti iddle
    const button2d2 = document.createElement("button");
    button2d2.textContent = "Parar tentar acerto"
    button2d2.addEventListener("click", () => {
      window.pararTentarAcerto()
    })

    buttonDiv1.append(button1d1, button2d1);
    buttonDiv2.append(button1d2, button2d2);

    box.append(buttonDiv1, buttonDiv2);



    // Título
    const title = document.createElement("div");
    title.textContent = "📜 Histórico do Chat";
    title.style.fontWeight = "bold";
    title.style.marginBottom = "8px";
    title.style.textAlign = "center";
    // title.style.cursor = "move"; // Cursor de arrastar
    title.style.userSelect = "none";
    box.appendChild(title);

    header.addEventListener("mousedown", function (e) {
      e.preventDefault();
      let offsetX = e.clientX - box.offsetLeft;
      let offsetY = e.clientY - box.offsetTop;

      const onMouseMove = (e) => {
        box.style.left = e.clientX - offsetX + "px";
        box.style.top = e.clientY - offsetY + "px";
      };

      const onMouseUp = () => {
        document.removeEventListener("mousemove", onMouseMove);
        document.removeEventListener("mouseup", onMouseUp);
      };

      document.addEventListener("mousemove", onMouseMove);
      document.addEventListener("mouseup", onMouseUp);
    });

    // Conteúdo
    const content = document.createElement("div");
    content.id = "gartic-float-content";
    content.style.flex = "1";
    content.style.overflowY = "auto";
    box.appendChild(content);

    // Resizer (canto inferior direito)
    const resizer = document.createElement("div");
    resizer.style.width = "10px";
    resizer.style.height = "10px";
    resizer.style.position = "absolute";
    resizer.style.right = "0";
    resizer.style.bottom = "0";
    resizer.style.cursor = "nwse-resize";
    resizer.style.background = "transparent"; // pode deixar visível se quiser
    box.appendChild(resizer);

    // Redimensionamento (horizontal e vertical)
    resizer.addEventListener(
      "mousedown",
      function (e) {
        e.preventDefault();
        const startX = e.clientX;
        const startY = e.clientY;
        const startWidth = parseInt(
          document.defaultView.getComputedStyle(box).width,
          10
        );
        const startHeight = parseInt(
          document.defaultView.getComputedStyle(box).height,
          10
        );

        const doDrag = function (e) {
          box.style.width = startWidth + e.clientX - startX + "px";
          box.style.height = startHeight + e.clientY - startY + "px";
        };

        const stopDrag = function () {
          document.documentElement.removeEventListener(
            "mousemove",
            doDrag,
            false
          );
          document.documentElement.removeEventListener(
            "mouseup",
            stopDrag,
            false
          );
        };

        document.documentElement.addEventListener("mousemove", doDrag, false);
        document.documentElement.addEventListener("mouseup", stopDrag, false);
      },
      false
    );

    document.body.appendChild(box);

    // Preenche com histórico
    chatLog.forEach((msg) => appendMessageToBox(msg));
  };

  // Adiciona uma mensagem na caixa flutuante
  const appendMessageToBox = ({ name, text }) => {
    const container = document.getElementById("gartic-float-content");
    if (!container) return;

    const line = document.createElement("div");
    line.style.marginTop = "5px";
    line.textContent = `${name}: ${text}`;
    container.appendChild(line);

    // Scroll para o final
    container.scrollTop = container.scrollHeight;
  };

  // Extrai info da mensagem
  const extractMessageData = (div) => {
    const strong = div.querySelector("strong");
    if (!strong) return null;

    const name = strong.textContent.trim();
    const text = div.textContent.replace(name, "").trim();

    return { name, text, timestamp: new Date().toISOString() };
  };

  // Observa novas mensagens
  if (window._garticChatObserver) {
    window._garticChatObserver.disconnect();
    console.log("[Gartic Chat Log] Observer anterior desligado.");
  } else {
    window._garticChatObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
          if (node.nodeType === 1) {
            const data = extractMessageData(node);
            if (data) {
              const isDuplicate = chatLog.some(
                (entry) => entry.name === data.name && entry.text === data.text
              );

              if (!isDuplicate) {
                chatLog.push(data);
                saveChatLog(chatLog);
                appendMessageToBox(data);
              }
            }
          }
        });
      });
    });
  }

  // observa novas respostas corretas
  if (window._garticRespostaObserver) {
    window._garticRespostaObserver.disconnect();
    console.log("[Gartic] Observer anterior desligado.");
  } else {
    window._garticRespostaObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
          if (node.nodeType !== 1) return; // ignora se não for elemento

          // Verifica se é uma mensagem do sistema
          if (
            node.classList.contains("sistema") &&
            node.textContent.includes("A resposta era")
          ) {
            const palavra = node.querySelector("strong")?.textContent.trim();
            if (palavra) {
              console.log("[Gartic] Resposta detectada:", palavra);

              // Se quiser salvar em um array global
              if (!window.respostasReveladas) window.respostasReveladas = [];
              window.respostasReveladas.push(palavra);

              const exists = window.respostasAcerto_objetos.indexOf(palavra);
              if (exists == "-1") {
                window.respostasAcerto_objetos.push(palavra);
              }
            }
          }

          // verifica se o desenho foi cancelado
          if (
            node.classList.contains("sistema") &&
            node.textContent.includes("Desenho cancelado")
          ) {
            console.log("[Gartic] Desenho terminou.");
            window.desenhoCancelado = true;
          }
          // verifica se o desenho foi cancelado
          if (
            node.classList.contains("sistema") &&
            node.textContent.includes("Intervalo")
          ) {
            console.log("[Gartic] Desenho terminou.");
            window.desenhoCancelado = true;
            window.tentativasDesenhoAtual = [];
          }
          // verifica acerto
          if (
            node.classList.contains("acerto") &&
            node.textContent.includes("Você acertou")
          ) {
            console.log("[Gartic] Acertou o desenho.");
            window.acertou = true;
          }
        });
      });
    });
  }


  // Comandos úteis no console
  window.verMensagensGartic = () => {
    console.table(chatLog);
    return chatLog;
  };

  window.limparMensagensGartic = () => {
    chatLog = [];
    saveChatLog(chatLog);
    const container = document.getElementById("gartic-float-content");
    if (container) container.innerHTML = "";
    console.log("[Gartic Chat Log] Histórico limpo.");
  };

  window.removerChat = () => {
    const el = document.getElementById("gartic-float-box");
    if (el) el.remove();
    console.log("chat removido");
  };

  window.criarChat = () => {
    console.log("chat criado");
    createFloatingBox();
  }

  window.obterDica = () => {
    // Seleciona spans de traços e espaços
    const spans = document.querySelectorAll(".dicaTxt .traco, .dicaTxt .espaco");

    let dica = "";
    spans.forEach((span) => {
      if (span.classList.contains("espaco")) {
        dica += " "; // espaço entre palavras
      } else {
        dica += span.innerHTML === "&nbsp;" || span.textContent.trim() === "" ? "_" : span.textContent;
      }
    });

    return dica;
  };

  // pega a dica formatada com x no lugar dos espaços em branco
  window.obterDicaFormatada = () => {
    // Seleciona spans ativos + espaços
    const spans = document.querySelectorAll(".dicaAtual .traco.ativo, .dicaAtual .espaco");

    let dicaFormatada = "";
    spans.forEach((span) => {
      if (span.classList.contains("espaco")) {
        dicaFormatada += " "; // mantém espaço entre palavras
      } else {
        dicaFormatada += (span.innerHTML === "&nbsp;" || span.textContent.trim() === "") 
          ? "x" 
          : span.textContent;
      }
    });

    return dicaFormatada;
  };

  window.darResposta = (resposta) => {
    // document.querySelector('#respostas form input').value
    const input = document.querySelector("#respostas form input");
    input.value = resposta;

    if(!tentativasDesenhoAtual.includes(resposta)){
      tentativasDesenhoAtual.push(resposta);
    }

    const form = document.querySelector("#respostas form");
    form.dispatchEvent(
      new Event("submit", { bubbles: true, cancelable: true })
    );
  };

  window.tentarAcerto = async () => {
    // reseta as flags globais
    window.desenhoCancelado = false;
    window.acertou = false;

    const dica = obterDicaFormatada();
    const tipo = getTipoSala();
    console.log("voce esta jogando em: ", {tipo, dica});
    let resposta;
    if (!dica) {
      switch (tipo) {
        case "objetos":
          resposta =
            window.respostasAcerto_objetos[
              Math.floor(Math.random() * window.respostasAcerto_objetos.length)
            ];
          break;

        case "animais":
          resposta =
            window.respostasAcerto_animais[
              Math.floor(Math.random() * window.respostasAcerto_animais.length)
            ];
          break;

        case "alimentos":
          resposta =
            window.respostasAcerto_alimentos[
              Math.floor(
                Math.random() * window.respostasAcerto_alimentos.length
              )
            ];
          break;

        case "geral":
          break;
      }

      console.log("A dica é, ", dica)
      console.log("[Gartic Bot] Resposta aleatoria:", resposta);
      if (resposta) {

        if(!tentativasDesenhoAtual.includes(resposta)){
          darResposta(resposta);
        }else{
          console.log(`A resposta: ${resposta}, ja foi dada no desenho atual`);
        }
      }
      return;
    }

    switch (tipo) {
      case "objetos":
        resposta = filtrarPorDica(dica, window.respostasAcerto_objetos);
        break;

      case "animais":
        resposta = filtrarPorDica(dica, window.respostasAcerto_animais);
        break;

      case "alimentos":
        resposta = filtrarPorDica(dica, window.respostasAcerto_alimentos);
        break;

      case "geral":
        break;
    }

    console.log("resposta por dica", {dica, resposta});
    if (resposta.length) {
      // darResposta(resposta[0]);
      for (const resultado of resposta) {
        if (window.desenhoCancelado || window.acertou) {
          console.log("[Gartic Bot] Tentativas pausadas: desenho terminou.");
          break;
        }
        if (resultado) {
          console.log("[Gartic Bot] Resposta enviada:", resultado);
          if(!tentativasDesenhoAtual.includes(resultado)){
            darResposta(resultado);
          } else {
            console.log(`A resposta: ${resultado}, ja foi dada no desenho atual`);
          }
          // darResposta(resultado);
          await sleep(500);
        }
      }
      return;
    }
    if (resposta) {
      darResposta(resposta);
    }
    return;
  };

  window.forcarAcerto = async () => {
    window.desenhoCancelado = false;

    const dica = obterDicaFormatada();
    let resultados;

    if (dica) {
      resultados = filtrarPorDica(dica, respostas);
    } else {
      resultados = window.respostasAcerto_objetos;
    }

    for (const resultado of resultados) {
      if (window.desenhoCancelado || window.acertou) {
        console.log("[Gartic Bot] Tentativas pausadas: desenho terminou.");
        break;
      }
      darResposta(resultado);
      await sleep(500);
    }
  };

  window.pararTentarAcerto = () => {
    window.acertou = true;
  }

  window.obterRespostasReveladas = () => {
    // pegar apenas as respostas que nao contenham nos objetos do arquivo
    const tipo = getTipoSala();

    console.log("respostas", window.respostasReveladas);

    return window.respostasReveladas;

    let resultado;
    switch (tipo) {
      case "objetos":
        resultado = window.respostasReveladas.filter(
          (p) => !window.respostasAcerto_objetos.includes(p)
        );
        break;
      case "animais":
        resultado = window.respostasReveladas.filter(
          (p) => !window.respostasAcerto_animais.includes(p)
        );
        break;
      case "alimentos":
        resultado = window.respostasReveladas.filter(
          (p) => !window.respostasAcerto_alimentos.includes(p)
        );
        break;
      case "geral":
        break;
    }
    if (resultado) {
      return resultado;
    }
    return [];
  };

  window.todasRespostas = () => {
    return window.respostasAcerto_objetos;
  };

  // objeto | alimento | geral
  window.getTipoSala = () => {
    return document.title.split(" ")[0].toLocaleLowerCase();
  };


  window.isAntiIdle = false;
  window._antiIdleInterval = null;
  window.ativarAntiIdle = (delay = 5000) => {
    if (window._antiIdleInterval) {
      clearInterval(window._antiIdleInterval); // garante que não fica resíduo
    }

    window.isAntiIdle = true;
    window._antiIdleInterval = setInterval(() => {
      const botaoOk = document.querySelector("#popupBt1");
      if (botaoOk) {
        botaoOk.click();
        console.log("AntiIdle: OK!");
      }
    }, delay);

    console.log("AntiIdle ativado!");
  };

  window.desativarAntiIdle = () => {
    if (!window.isAntiIdle || !window._antiIdleInterval) return; // já está desativado

    clearInterval(window._antiIdleInterval);
    window._antiIdleInterval = null;
    window.isAntiIdle = false;
    console.log("AntiIdle desativado!");
  };

  main();
})();
